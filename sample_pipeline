pipeline {
environment {
registry = "aksharabits/sample"
registryCredential = 'aksharabits'
dockerImage = ''
}
agent {label 'docker-agent'}
stages {
stage('Cloning our Git') {
steps {
git 'https://github.com/AksharaBits/DevSecOps_Project.git'
}
}
stage('Building our image') {
steps{
dir('Blog app'){
script {
dockerImage = docker.build(registry + ":$BUILD_NUMBER", "/docker/Dockerfile .")
}
}
}
}
stage('Deploy our image') {
steps{
script {
docker.withRegistry( '', registryCredential ) {
dockerImage.push()
}
}
}
}
stage('Cleaning up') {
steps{
sh "docker rmi $registry:$BUILD_NUMBER"
}
}
}
}
